version: 1

# 1) Full Cartesian product lives here
matrix:
  accountant: ["zcdp", "eps_delta"]
  gamma_bar: [1.0]
  gamma_split: [0.3, 0.5, 0.7]
  delete_ratio: [3, 5]

  # Oracle block (optional)
  enable_oracle: [true, false]
  comparator: ["dynamic", "static"]
  oracle_window_W: [256, 512]
  oracle_steps: [10, 15]
  oracle_stride: [null, 128]
  oracle_tol: [1e-6]
  oracle_warmstart: [true]
  path_length_norm: ["L2"]
  lambda_reg: [0.0, 1e-3]

  # L-BFGS / SC
  m_max: [10]
  d_max: [null, 5.0]
  lbfgs_pair_gate_m_t: [0.0, 1e-3]
  lbfgs_spectrum_clip: [[1e-6, 1e3]]
  ema_beta: [0.9]
  lambda_est_beta: [0.1]
  lambda_est_bounds: [[1e-8, 1e4]]

  # Calib / N*
  bootstrap_iters: [500]
  quantile: [0.9]
  D_cap: [10.0]
  trim_quantile: [0.9]

  # Accountant specifics
  rho_total: [1.0]     # used if accountant=zcdp
  eps_total: [1.0]     # used if accountant=eps_delta
  delta_total: [1e-5]
  delta_b: [0.05]

# 2) Named selectors
selectors:
  - name: baseline
    where:
      accountant: ["zcdp", "eps_delta"]
      gamma_split: [0.3, 0.5]
      enable_oracle: [false]
  - name: experiment_a
    where:
      # Experiment A requires oracle for regret tracking/bound adherence analysis
      accountant: ["zcdp", "eps_delta"]
      gamma_split: [0.3, 0.5, 0.7]
      enable_oracle: [true]
      comparator: ["dynamic", "static"]
  - name: lbfgs_ablation
    where:
      lbfgs_pair_gate_m_t: [0.0, 1e-3]
      d_max: [null, 5.0]
  - name: static_only
    where:
      comparator: ["static"]

# 3) Include subset to run
include:
  - baseline
  - experiment_a  # Enable oracle for regret tracking in Experiment A
  - lbfgs_ablation
  - { where: { accountant: "zcdp", gamma_split: [0.7] } }

# 4) Optional explicit cases
cases:
  - { gamma_split: 0.7, comparator: "static", d_max: null }

# 5) Exclude rules
exclude:
  - { where: { accountant: "eps_delta", lambda_reg: 0.0 } }
  - { where: { enable_oracle: true, oracle_stride: 128 } }

# 6) Optional cap on total selected cells
limit: 120
